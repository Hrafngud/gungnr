## Warp Panel - Project Tracker

- Scope: Web control panel to perform all deploy.sh tasks from a browser. It runs on the host PC (Docker, filesystem, cloudflared access) and is served via Cloudflare Tunnel for remote control.
- Principle: `deploy.sh` is reference-only; do not modify it. The UI must reproduce its CLI behavior before advanced setups.
- Core flows:
  - Create new project from a GitHub template, clone locally, patch compose ports, build and run.
  - Deploy an existing local template project (compose up if needed).
  - Expose a quick local service (any running port) via tunnel + DNS.
  - Manage tunnel ingress and DNS for subdomains on the configured zone.
  - Guide onboarding with step-by-step hints and links for required API keys.
- Deliverables:
  - Go API with authenticated GitHub login, Cloudflare and GitHub integrations, job runner, audit logs.
  - Vue UI with dark zinc skeuomorphic theme, sidebar navigation, and dedicated pages for Home, Overview, Host Settings, Networking, and GitHub config.
  - Docker Compose stack with Postgres, API, and web frontend.
- Tech decisions:
  - Backend: Go 1.22+, Gin, GORM + pgx, go-github, cloudflared CLI, oauth2.
  - Frontend: Vue 3 + Vite + TS, Tailwind CSS v4, Pinia, Axios, vue-router.
  - DB: Postgres for projects, jobs, and audit logs.
  - Host access: Docker socket bind, templates dir bind, cloudflared config bind.
- Progress log:
  - DONE: Use host-installed `cloudflared` service as the only tunnel path; removed the compose cloudflared container.
  - DONE: Implement API Docker runner (socket-based) to run containers/compose directly from jobs.
  - DONE: Cloudflare DNS/ingress updates confirmed healthy; focus shifts to Docker runner UX and retiring host-worker flow.
  - TODO: Update UI copy and help modals to instruct host operators on tunnel setup and host command execution.
  - TODO: Persist onboarding state in the backend so overlays do not reappear.
  - TODO: Redesign sidebar collapse UX (icon-only, control in sidebar only).
  - TODO: Increase main content width by reducing horizontal padding/margins.
  - TODO: Replace native selects with a universal custom Select component.
  - TODO: Fix login flow to auto-redirect on `/auth/me` success.
  - TODO: Update login page layout to the two-column design.
  - TODO: Refactor Home Quick Deploy into card grids for Templates/Services; show deploy forms only when selected.
  - TODO: Replace placeholder notes docs with Warp Panel plans and guidelines.
  - TODO: Visual rework for dark zinc skeuomorphic theme, component variants, and standardized animations.
  - TODO: Rebuild navigation with expandable sidebar, top bar, and footer.
  - TODO: Split pages into Home, Overview, Host Settings, Networking, and GitHub config.
  - TODO: Add onboarding overlay journey and day-to-day flow polish.
  - TODO: Update login to two-column layout and popup GitHub OAuth.
- DONE: Add root README runbook + Makefile; compose smoke test succeeded (warning: buildx plugin missing).
- DONE: Add settings persistence + UI for base domain, GitHub token, Cloudflare token, and cloudflared config path (default to ~/.cloudflared/config.yml).
- DONE: Surface running Docker containers and allow quick tunnel forwarding with subdomains.
- DONE: Add cloudflared config preview in the Settings UI.
- DONE: Validation pass after Dockerfile arch fix (compose build + end-to-end flows per user).
- DONE: Add tunnel status health checks and status panel in the UI.
- DONE: Implement GitHub OAuth login + allowlist scaffolding with session cookies.
- DONE: Protect `/api/v1` routes with auth middleware and add project/job list placeholders.
- DONE: Add integrations stubs, job runner scaffold, and Projects/Jobs UI views.
- DONE: Gate UI routes behind auth (login-only access for unauthenticated users).
- DONE: Resolve GitHub OAuth callback URLs from the public host when local defaults leak.
  - DONE: Allow configuring auth cookie domain to avoid invalid OAuth state on cross-subdomain callbacks.
  - DONE: Fix GitHub user lookup to use the correct GORM column mapping.
- DONE: Implement job runner persistence, workflow handlers, and job log streaming.
- DONE: Add host-worker job type with one-time tokens plus host fetch/log/complete endpoints.
- NOTE: Decision shift - prefer API-run Docker socket runner (Option A) and treat host worker flow as legacy.
- DONE: Wire template creation, deploy existing, and quick service endpoints + UI flows.
- DONE: Add GitHub template creation + cloudflared DNS/ingress updates in workflows.
- DONE: Build UI shell and connect to API for `/auth/me`.
- DONE: Add audit log model, API, and Activity UI for tracking user actions.
- DONE: Compose smoke test after audit logging (buildx warning persists).
- DONE: Apply dark zinc theme tokens and base styles for the frontend refresh.
- DONE: Replace the header with the new AppShell (sidebar + top bar) navigation.
- DONE: Introduce the new page map (Home, Overview, Host Settings, Networking, GitHub), add new views, update nav, and redirect legacy routes.
- DONE: Refactor the Home view to the Host Status + Quick Deploy layout.
- DONE: Refactor the Overview view to the host snapshot layout with container highlights, job summary, and recent activity; restyle Jobs/Activity panels to the dark zinc variants.
- DONE: Refactor the Host Settings view to the dark zinc tokens and AppShell layout.
- DONE: Refactor the Networking view to the dark zinc tokens and AppShell layout.
- DONE: Refactor the GitHub view to the dark zinc tokens and AppShell layout.
- DONE: Introduce base UI components (Button, Input, Select, Toggle, Panel, Badge) and refactor Home to use them.
- DONE: Migrate the Overview view to base UI components with shared state blocks.
- DONE: Add ListRow, Tooltip, and Modal/Sheet base components plus a shared loading state pattern.
- DONE: Migrate Jobs and Activity views to base components + UiState blocks; update Host Settings, Networking, and GitHub with UiState/UiListRow and shared loading indicators.
- DONE: Flatten the UI to a zinc monochrome palette (remove gradients/glass), simplify Home host status layout, and align login + job log styling.
- DONE: Add popup GitHub OAuth flow with /auth/me polling for the login view.
- DONE: Redirect to the panel after successful GitHub OAuth login.
- DONE: Add toast notifications and standardized inline feedback for Host Settings and Home deploy forms.
- DONE: Add onboarding overlays for Home + Host Settings with API key links, plus day-to-day guidance callouts for quick deploy and recent activity.
- DONE: Extend onboarding overlays to Networking and GitHub with refresh + token guidance.
- DONE: Add day-to-day guidance callouts in Jobs and Activity, and introduce turquoise accent/status colors for indicators.
- DONE: Add GitHub catalog endpoint (token/template/allowlist summary) and wire GitHub view to real data.
- DONE: Expand Networking with ingress-derived DNS list and Cloudflare readiness panel.
- DONE: Add host worker command modal (copy + polling) and route deploy actions through `/jobs/host-deploy`.
- DONE: Surface `pending_host` status in job badges/counts and replace native selects with the custom UiSelect.
- DONE: Harden tunnel health checks with origin cert discovery + clearer missing-cert feedback.
- DONE: Tune nginx SSE proxy settings for job log streaming.
- DONE: Force HTTPS API base URL when the panel is served over HTTPS to prevent mixed-content blocks.
- DONE: Move tunnel DNS + ingress updates to Cloudflare API and add account/zone settings for jobs.
- DONE: Add Cloudflare token scope guidance (UI + README) and clarify auth errors for invalid tokens.
- DONE: Improve Cloudflare tunnel error logging with remote-managed tunnel guidance.
- DONE: Added tunnel health diagnostics (account/zone/tunnel sources) and return non-200 status codes for tunnel health errors.
- DONE: Add live container logs screen for all running containers (not just deploy jobs).
- DONE: Add a responsive top bar on the logs screen so controls fit at all widths.
- DONE: Add copy logs action, collapsible sidebar controls, and enhanced container log details.
- DONE: Improve external API error logging for Cloudflare/GitHub responses with response metadata and payload summaries.
- DONE: Capture GitHub error response body snippets for clearer API failure logs.
- DONE: Improve GitHub OAuth error logging with response status/body details for token exchange and user/org checks.
- DONE: Retire host-worker UI flow (remove host command modal and pending_host labels) and add quick-service image/container port inputs with hints.
- DONE: Remove host-worker backend endpoints/job type and normalize pending_host to pending in job responses.
- DONE: Compose smoke test run locally; buildx plugin warning persists.
- NOTE: Frontend smoke test blocked; `npm run build` failed because `vue-tsc` is not available (install deps locally).
- NOTE: User will run smoke tests locally.
- NOTE: Cloudflare API auth error code 10000 persists in `/health/tunnel` despite valid token claims; likely settings mismatch (DB overrides env) or account/zone mismatch.
- NOTE: `docker compose up --build` completed; buildx plugin warning persists.
- NOTE: Cloudflare docs confirm `config.yml` ingress rules must end with a catch-all rule, and DNS records can be created via `cloudflared tunnel route dns` (requires cert.pem).

### Docker / Compose usage (target)
- Defaults live in `.env.example` (copy to `.env` to override).
- Build + run: `docker compose up --build`.
- Stop and clean volumes: `docker compose down -v`.
- Ports: proxy `http://localhost` (80), Postgres `localhost:5432`. API/web ports are internal unless you uncomment mappings in `docker-compose.yml`.

### Risks to track
- Security: browser-accessible control panel must strictly restrict who can run host actions.
- Secrets: GitHub and Cloudflare tokens stored safely (env or encrypted at rest).
- Safety: job runner must avoid arbitrary command execution and sanitize inputs.
